"use strict";

require("@testing-library/jest-dom");
var _react = require("@testing-library/react");
var _Video = _interopRequireDefault(require("../Video"));
var _jsxRuntime = require("react/jsx-runtime");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }
/* global HTMLMediaElement */

describe('VideoPlayer.Video', function () {
  beforeEach(function () {
    jest.spyOn(HTMLMediaElement.prototype, 'load').mockImplementation(function () {
      return true;
    });
  });
  afterEach(function () {
    HTMLMediaElement.prototype.load.mockRestore();
  });
  describe('changing sources', function () {
    test('should not render `preloadSource` when not present', function () {
      (0, _react.render)( /*#__PURE__*/(0, _jsxRuntime.jsx)(_Video["default"], {
        "data-testid": "video-id",
        source: "abc.mp4"
      }));
      var actual = _react.screen.getByTestId('video-id').nextElementSibling;
      expect(actual).toBeNull();
    });
    test('should use the same node when adding `preloadSource`', function () {
      var _render = (0, _react.render)( /*#__PURE__*/(0, _jsxRuntime.jsx)(_Video["default"], {
          "data-testid": "video-id",
          source: "abc.mp4"
        })),
        rerender = _render.rerender;
      var expected = _react.screen.getByTestId('video-id');
      rerender( /*#__PURE__*/(0, _jsxRuntime.jsx)(_Video["default"], {
        "data-testid": "video-id",
        preloadSource: "def.mp4",
        source: "abc.mp4"
      }));
      var actual = _react.screen.getByTestId('video-id');
      expect(actual).toBe(expected);
    });
    test('should render `preloadSource` when added', function () {
      var _render2 = (0, _react.render)( /*#__PURE__*/(0, _jsxRuntime.jsx)(_Video["default"], {
          "data-testid": "video-id",
          source: "abc.mp4"
        })),
        rerender = _render2.rerender;
      rerender( /*#__PURE__*/(0, _jsxRuntime.jsx)(_Video["default"], {
        "data-testid": "video-id",
        preloadSource: "def.mp4",
        source: "abc.mp4"
      }));
      var actual = _react.screen.getByTestId('video-id').nextElementSibling;
      expect(actual).not.toBeNull();
      expect(actual.tagName).toBe('VIDEO');
    });
    test('should use the same node when adding `preloadSource` the same as source', function () {
      var _render3 = (0, _react.render)( /*#__PURE__*/(0, _jsxRuntime.jsx)(_Video["default"], {
          "data-testid": "video-id",
          source: "abc.mp4"
        })),
        rerender = _render3.rerender;
      var expected = _react.screen.getByTestId('video-id');
      rerender( /*#__PURE__*/(0, _jsxRuntime.jsx)(_Video["default"], {
        "data-testid": "video-id",
        preloadSource: "abc.mp4",
        source: "abc.mp4"
      }));
      var actual = _react.screen.getByTestId('video-id');
      expect(actual).toBe(expected);
    });
    test('should swap nodes when swapping `source` and `preloadSource`', function () {
      var _render4 = (0, _react.render)( /*#__PURE__*/(0, _jsxRuntime.jsx)(_Video["default"], {
          "data-testid": "video-id",
          preloadSource: "def.mp4",
          source: "abc.mp4"
        })),
        rerender = _render4.rerender;
      var source = _react.screen.getByTestId('video-id');
      var preload = _react.screen.getByTestId('video-id').nextElementSibling;
      rerender( /*#__PURE__*/(0, _jsxRuntime.jsx)(_Video["default"], {
        "data-testid": "video-id",
        preloadSource: "abc.mp4",
        source: "def.mp4"
      }));
      var newSource = _react.screen.getByTestId('video-id');
      var newPreload = _react.screen.getByTestId('video-id').nextElementSibling;
      expect(newSource).toBe(preload);
      expect(newPreload).toBe(source);
    });
    test('should swap nodes when preload does not exist initially', function () {
      var _render5 = (0, _react.render)( /*#__PURE__*/(0, _jsxRuntime.jsx)(_Video["default"], {
          "data-testid": "video-id",
          source: "abc.mp4"
        })),
        rerender = _render5.rerender;
      var source = _react.screen.getByTestId('video-id');
      rerender( /*#__PURE__*/(0, _jsxRuntime.jsx)(_Video["default"], {
        "data-testid": "video-id",
        preloadSource: "def.mp4",
        source: "abc.mp4"
      }));
      var preload = _react.screen.getByTestId('video-id').nextElementSibling;
      rerender( /*#__PURE__*/(0, _jsxRuntime.jsx)(_Video["default"], {
        "data-testid": "video-id",
        preloadSource: "abc.mp4",
        source: "def.mp4"
      }));
      var newSource = _react.screen.getByTestId('video-id');
      var newPreload = _react.screen.getByTestId('video-id').nextElementSibling;
      expect(newSource).toBe(preload);
      expect(newPreload).toBe(source);
    });
  });
});